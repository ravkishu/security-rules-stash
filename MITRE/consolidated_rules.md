
[//]: # (This is an autogenerated file using ./tools/consolidate-rules.sh script. Do not edit manually.)

## [./Impact/Data Destruction/README.md](./Impact/Data%20Destruction/README.md)
Audit execution of file delete/modify in context of systems binary folders such
as `/bin/*, /usr/bin/*, /usr/sbin/*`.

## [./Execution/Native API/README.md](./Execution/Native%20API/README.md)
Linux has an API `syscall(long nrnum,
...)`[ref](https://linux.die.net/man/2/syscall) using which an attacker can
bypass libc APIs and directly invoke the syscall based on its number. If an
attempt is made to do so it can be used as an alert because usually the
processes depend on libc to make syscalls.

OpenBSD has [a way to identify the syscall
origination](https://lwn.net/Articles/806776/) and then limit access to it.
This could be the best enforcement technique but needs detailed analysis in the
context of Linux kernel.

## [./Execution/Scheduled Task_Job/Cron/README.md](./Execution/Scheduled%20Task_Job/Cron/README.md)
Send an alert if process `cron` is invoked. These processes operate at host level and are used for periodic execution.

Send an alert if file access is done to any of the following files:
```
/etc/crontab
```

## [./Execution/Scheduled Task_Job/At/README.md](./Execution/Scheduled%20Task_Job/At/README.md)
Send an alert if process `at` is invoked. These processes operate at host level and are used for periodic execution.

Send an alert if file access is done to any of the following files:
```
/etc/at.allow
/etc/at.deny
```

## [./Execution/Scheduled Task_Job/README.md](./Execution/Scheduled%20Task_Job/README.md)
Send an alert if processes (cron | at) are invoked. These processes operate at host level and are used ofr periodic execution.

Send an alert if file access is done to any of the following files:
```
/etc/crontab
/etc/at.allow
/etc/at.deny
```

## [./Execution/Scheduled Task_Job/Systemd Timers/README.md](./Execution/Scheduled%20Task_Job/Systemd%20Timers/README.md)
Send an alert if file access is done to any of the following files:
```
/lib/systemd/system/*.timer
```
These might include but not limited to:
```
/lib/systemd/system/apt-daily.timer
/lib/systemd/system/apt-daily-upgrade.timer
/lib/systemd/system/e2scrub_all.timer
/lib/systemd/system/fstrim.timer
/lib/systemd/system/logrotate.timer
/lib/systemd/system/man-db.timer
/lib/systemd/system/sysstat-collect.timer
/lib/systemd/system/sysstat-summary.timer
/lib/systemd/system/systemd-tmpfiles-clean.timer
```

## [./Execution/Command and Scripting Interpreter/Unix Shell/README.md](./Execution/Command%20and%20Scripting%20Interpreter/Unix%20Shell/README.md)
VAE could detect unknown shell access attempted in any container.

## [./Defense Evasion/Impair Defenses/Disable or Modify Tools/README.md](./Defense%20Evasion/Impair%20Defenses/Disable%20or%20Modify%20Tools/README.md)
Audit any event which could lead to disabling of LSMs:
For SELinux, audit any edits to following filesystem paths:
```
/etc/selinux/*
/etc/sysconfig/selinux
```
Audit process execution such as:
```
setenforce
```

## [./Defense Evasion/Impair Defenses/Disable or Modify System Firewall/README.md](./Defense%20Evasion/Impair%20Defenses/Disable%20or%20Modify%20System%20Firewall/README.md)
Audit following processes which generate firewall rules.
```
iptables
ebtables
```
Similarly, netfilter kprobes could be monitored to detect addition of netfilter rules through any other non-standard bins.
Exclusions should be made for docker, k8s processess (such as kube-proxy) who depend on creating these rules.

## [./Defense Evasion/Impair Defenses/Impair Command History Logging/README.md](./Defense%20Evasion/Impair%20Defenses/Impair%20Command%20History%20Logging/README.md)
Audit file changes to `./bash_history` from non-bash parent process. This will
filter the processes which try to directly open the bash_history file.

In case of other shell (take example of OhMyZsh shell)
In that case: Audit file changes to `./zsh_history` from non-bash parent process.

## [./Defense Evasion/File and Directory Permissions Modification/Linux and Mac File and Directory Permissions Modification/README.md](./Defense%20Evasion/File%20and%20Directory%20Permissions%20Modification/Linux%20and%20Mac%20File%20and%20Directory%20Permissions%20Modification/README.md)
Audit following processes `chown, chmod`.

## [./Defense Evasion/Masquerading/Rename System Utilities/README.md](./Defense%20Evasion/Masquerading/Rename%20System%20Utilities/README.md)
Audit file copy events for `/usr/bin`, `/bin` folders.
Audit file rename events for `/usr/bin`, `/bin` folders.
Audit file copy events for `/usr/local/bin` folders.
Audit file rename events for `/usr/local/bin` folders.

## [./Defense Evasion/Modify Authentication Process/Pluggable Authentication Modules/README.md](./Defense%20Evasion/Modify%20Authentication%20Process/Pluggable%20Authentication%20Modules/README.md)
Monitor PAM configuration and module paths `/etc/pam.d/, pam_unix.so, /etc/passwd, /etc/shadow` for changes.

## [./Defense Evasion/Subvert Trust Controls/Install Root Certificate/README.md](./Defense%20Evasion/Subvert%20Trust%20Controls/Install%20Root%20Certificate/README.md)
Audit the file system paths which have access to root certificates. Any
modification to following path `/usr/local/share/ca-certificates/*` should
raise an alert.

## [./Defense Evasion/Deobfuscate_Decode Files or Information/README.md](./Defense%20Evasion/Deobfuscate_Decode%20Files%20or%20Information/README.md)
Audit invocation of process `/usr/bin/certutil`. Certutil is commonly used to decode a remote access tool portable executable file that has been hidden inside a certificate file.

## [./Defense Evasion/Hide Artifacts/Hidden Files and Directories/README.md](./Defense%20Evasion/Hide%20Artifacts/Hidden%20Files%20and%20Directories/README.md)
Audit creation of files with '.' prefix (indicating hidden files).

## [./Credential Access/Unsecured Credentials/Private Keys/README.md](./Credential%20Access/Unsecured%20Credentials/Private%20Keys/README.md)
Audit access to any files ending with extensions (.key, .pgp, .gpg, .ppk.,
.p12, .pem, .pfx, .cer, .p7b, .asc).  This rule alone might be insufficient
since it will generate false alerts. {TODO: Is there any other heuristic that
can be added here?}

## [./Credential Access/OS Credential Dumping/_etc_passwd and _etc_shadow/README.md](./Credential%20Access/OS%20Credential%20Dumping/_etc_passwd%20and%20_etc_shadow/README.md)
Audit any file open for `/etc/passwd` and `/etc/shadow`. Note that this is too
generic of a rule and additional checks needs to be thought of to reduce false
positives.

## [./Credential Access/Man-in-the-Middle/ARP Cache Poisoning/README.md](./Credential%20Access/Man-in-the-Middle/ARP%20Cache%20Poisoning/README.md)
Audit use of gratuitous ARP reply packets on the host. Note that gratuitous ARP
request packets could be used for IP conflict verification in normal scenarios
and thus only gratuitous replies need to be audited.

From the sender's perspective, audit any gratuitous ARP send.

## [./Collection/Data from Cloud Storage Object/README.md](./Collection/Data%20from%20Cloud%20Storage%20Object/README.md)
Check if sensitive configuration data or user's data stores are ended up in public folders.
Accuknox data-protection policies can audit/track sensitive data in the k8s env.

## [./Collection/Archive Collected Data/Archive via Utility/README.md](./Collection/Archive%20Collected%20Data/Archive%20via%20Utility/README.md)
1. Check if any of the following external utilities are been used to compress file or data `bzip2, tar, zip, json.gz`

1. Enforce copy-protection for executables `bzip2, tar, zip, json.gz`. If anyone attempts to copy these files to a different name then block the copy attempt.

## [./Collection/Archive Collected Data/Archive via Library/README.md](./Collection/Archive%20Collected%20Data/Archive%20via%20Library/README.md)
Audit if the invoked process which is not part of standard bins (bzip2, zip,
rar, unrar, tar) is linked to any compression lib: `(ps_name != listofbins) &&
ps_linkedso == (libbz2.* || libz.*)`

This might still result in false positives since there are too many bins which
makes use of generic compression libs such as libz for data compression before
network transmission (for e.g, nginx, apache, etc).


## [./Command and Control/Non-Standard Port/README.md](./Command%20and%20Control/Non-Standard%20Port/README.md)
Zero trust based network policy settings would avoid such attacks.

## [./Command and Control/Non-Application Layer Protocol/README.md](./Command%20and%20Control/Non-Application%20Layer%20Protocol/README.md)
There are two types of protocols that are possible:
1. Use of non-standard transport protocols: This can be taken care using zero-trust based network policy settings.
2. ICMP traffic accounting could help audit ICMP based payloads.

## [./Command and Control/Application Layer Protocol/Web Protocols/README.md](./Command%20and%20Control/Application%20Layer%20Protocol/Web%20Protocols/README.md)
Zero-trust based network settings would avoid any process/container from
sending packets to an unknown destination.

## [./Command and Control/Application Layer Protocol/DNS/README.md](./Command%20and%20Control/Application%20Layer%20Protocol/DNS/README.md)
Do DNS query accounting. If the size of the DNS communication payload exceeds
more that double the average DNS comm payload then raise an alert. This is a
stateful activity which means the audit/enforcement engine needs to track the
DNS req/rsp between the peers and subsequently use it for inference purpose.
Cilium currently keeps the map of the DNS req/rsp and thus may need to add
additional logic to detect such an attack. Another option is to use a ebpf
based accounting module to keep track of this.

## [./Command and Control/Application Layer Protocol/File Transfer Protocols/README.md](./Command%20and%20Control/Application%20Layer%20Protocol/File%20Transfer%20Protocols/README.md)
Zero-trust based network settings would avoid any process/container from
sending packets to an unknown destination.

## [./Command and Control/Dynamic Resolution/Domain Generation Algorithms/README.md](./Command%20and%20Control/Dynamic%20Resolution/Domain%20Generation%20Algorithms/README.md)
One way to handle this is to use DNS resolution accounting system. Every DNS
resolution should result in an alert event to the backend. The backend can then
aggregate these events and possibly run post-processing actions such as if the
number of DNS resolutions in a given time frame is more than a threshold then
it generates an alert.

Post-processing action is: Check the number of DNS resolutions in past 10 hours
and if the number is more than the average of past week then raise an alert.

## [./Persistence/Create Account/Local Account/README.md](./Persistence/Create%20Account/Local%20Account/README.md)
Audit following files on the host file system:
```
/etc/passwd
/etc/shadow
```
Audit use of following processes:
```
useradd
adduser
usermod
```

## [./Persistence/Traffic Signaling/Port Knocking/README.md](./Persistence/Traffic%20Signaling/Port%20Knocking/README.md)
If a network packet is rcvd to unknown port or if the network packet is dropped
(not denied) because it does not have any service waiting for it then log the
packet details.

## [./Persistence/Pre-OS Boot/Bootkit/README.md](./Persistence/Pre-OS%20Boot/Bootkit/README.md)
Take a snapshot of MBR on agent installation and verify periodically.
```
#Take a snapshot of the MBR where /dev/nvme0n1 is the disk from which the machine booted.
$ dd if=/dev/nvme0n1 of=tmp1 bs=512 count=1

# How to identity the boot partition?
$ lsblk | grep boot
```

## [./Persistence/Hijack Execution Flow/LD_PRELOAD/README.md](./Persistence/Hijack%20Execution%20Flow/LD_PRELOAD/README.md)
Check if the process is spawned with certain risky environment variables such
as `LD_PRELOAD`. Use of `LD_PRELOAD` implies that the preloaded dynamic library
could intercept and hijack any library calls.

When the process is execed, the logic can check whether the env var for the
spawned process contains `LD_PRELOAD` by looking into `/proc/<pid>/environ`.

## [./Persistence/Boot or Logon Autostart Execution/Kernel Modules and Extensions/README.md](./Persistence/Boot%20or%20Logon%20Autostart%20Execution/Kernel%20Modules%20and%20Extensions/README.md)
Audit following two syscalls to check if any kernel module is been dynamically inserted.
```
init_module()
finit_module()
```
Similarly, execution of following commands could be audited.
```
modprobe
insmod
lsmod
rmmod
modinfo
```
One challenge is that this auditing should be enabled before any other module
is started. One way to handle it could be to do kernel module accounting and
report any updates to the kernel modules.

## [./Persistence/Create or Modify System Process/Systemd Service/README.md](./Persistence/Create%20or%20Modify%20System%20Process/Systemd%20Service/README.md)
Audit file system changes in any of the following places:
```
/etc/systemd/system
/usr/lib/systemd/system
/lib/systemd/system
*/.config/systemd/user
```

## [./Persistence/Event Triggered Execution/bash_profile and bashrc/README.md](./Persistence/Event%20Triggered%20Execution/bash_profile%20and%20bashrc/README.md)
Audit modification of the following bash configuration files:
```
.bash_profile
/etc/profile
.bashrc
```

## [./Privilege Escalation/Abuse Elevation Control Mechanism/Sudo and Sudo Caching/README.md](./Privilege%20Escalation/Abuse%20Elevation%20Control%20Mechanism/Sudo%20and%20Sudo%20Caching/README.md)
Audit any activity on /etc/sudoers file. In general, in k8s env, there is no sudo user that can be present.

## [./Privilege Escalation/Abuse Elevation Control Mechanism/Setuid and Setgid/README.md](./Privilege%20Escalation/Abuse%20Elevation%20Control%20Mechanism/Setuid%20and%20Setgid/README.md)
Audit processes spawned with s-bit set. In general, in k8s env, it is not
expected that the s-bit will be set for any process within the container.
Even on the host, there should not be any process with the s-bit set in context
of k8s env.

## [./Privilege Escalation/Process Injection/Ptrace System Calls/README.md](./Privilege%20Escalation/Process%20Injection/Ptrace%20System%20Calls/README.md)
Disable use of ptrace() syscall.

## [./Privilege Escalation/Process Injection/Proc Memory/README.md](./Privilege%20Escalation/Process%20Injection/Proc%20Memory/README.md)
Enforce rule to shutdown process which attempts to write to the `/proc/<pid>/maps` and `/proc/<pid>/mem` files.
[Ref exploit code](https://blog.gdssecurity.com/labs/2017/9/5/linux-based-inter-process-code-injection-without-ptrace2.html)

## [./Initial Access/Exploit Public-Facing Application/README.md](./Initial%20Access/Exploit%20Public-Facing%20Application/README.md)
Use an external tool such as Nuclei to identify open vulnerabilities in the front-facing microservices, databases, portals.

## [./Reconnaissance/Active Scanning/Scanning IP Blocks/README.md](./Reconnaissance/Active%20Scanning/Scanning%20IP%20Blocks/README.md)

A malicious attacker will try to scan the list of usable target IPs by using TCP/UDP/ICMP scans. Following rules could be used to detect initiation of such scanning:
1. The scanner finds SCAN_THRESHOLD number of unique addresses per second that are scanned by checking TCP SYN.
2. The scanner finds SCAN_THRESHOLD number of unique addresses per second that are scanned by checking ICMP requests.

A host could detect that there is an active scanner in the network by detecting scans involved across multiple ports.

1. Check if there are TCP SYNs sent across multiple TCP ports on the same host/container. SCAN_THRESHOLD parameter could be used to set the limit.

